#!/bin/bash

# Set the path to the database
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DATABASE="$SCRIPT_DIR/mydatabase.db"

# Ensure the database file exists
if [ ! -f "$DATABASE" ]; then
    sqlite3 "$DATABASE" "CREATE TABLE IF NOT EXISTS quotes (id INTEGER PRIMARY KEY, quote TEXT);
                          CREATE TABLE IF NOT EXISTS todos (id INTEGER PRIMARY KEY, task TEXT, done BOOLEAN);"
fi

function show_help {
    echo "Usage: quote_todo_manager [option]"
    echo ""
    echo "Options:"
    echo "  -a, --add-quote QUOTE        Add a new quote"
    echo "  -v, --view-quotes            View all quotes"
    echo "  -d, --delete-quote ID        Delete a quote by ID"
    echo "  -t, --add-todo TASK          Add a new to-do"
    echo "  -l, --view-todos             View all to-dos"
    echo "  -r, --delete-todo ID         Delete a to-do by ID"
    echo "  -m, --mark-done ID           Mark a to-do as done by ID"
    echo "  -h, --help                   Show this help message"
}

function add_quote {
    local quote="$1"
    if [ -z "$quote" ]; then
        echo "Error: Quote cannot be empty."
        exit 1
    fi
    sqlite3 "$DATABASE" "INSERT INTO quotes (quote) VALUES ('$quote');"
    echo "Quote added: $quote"
}

function view_quotes {
    sqlite3 "$DATABASE" "SELECT id, quote FROM quotes;" | while IFS="|" read -r id quote; do
        echo "$id: $quote"
    done
}

function delete_quote {
    local id="$1"
    if ! [[ "$id" =~ ^[0-9]+$ ]]; then
        echo "Error: Quote ID must be a number."
        exit 1
    fi
    sqlite3 "$DATABASE" "DELETE FROM quotes WHERE id = $id;"
    echo "Quote $id deleted"
}

function add_todo {
    local task="$1"
    if [ -z "$task" ]; then
        echo "Error: Task cannot be empty."
        exit 1
    fi
    sqlite3 "$DATABASE" "INSERT INTO todos (task, done) VALUES ('$task', 0);"
    echo "To-do added: $task"
}

function view_todos {
    sqlite3 "$DATABASE" "SELECT id, task, done FROM todos;" | while IFS="|" read -r id task done; do
        status="pending"
        [ "$done" -eq 1 ] && status="done"
        echo "$id: $task [$status]"
    done
}

function delete_todo {
    local id="$1"
    if ! [[ "$id" =~ ^[0-9]+$ ]]; then
        echo "Error: To-do ID must be a number."
        exit 1
    fi
    sqlite3 "$DATABASE" "DELETE FROM todos WHERE id = $id;"
    echo "To-do $id deleted"
}

function mark_done {
    local id="$1"
    if ! [[ "$id" =~ ^[0-9]+$ ]]; then
        echo "Error: To-do ID must be a number."
        exit 1
    fi
    sqlite3 "$DATABASE" "UPDATE todos SET done = 1 WHERE id = $id;"
    echo "To-do $id marked as done"
}

case "$1" in
    -a|--add-quote)
        if [ -z "$2" ]; then
            echo "Error: No quote provided."
            show_help
            exit 1
        fi
        add_quote "$2"
        ;;
    -v|--view-quotes)
        view_quotes
        ;;
    -d|--delete-quote)
        if [ -z "$2" ]; then
            echo "Error: No quote ID provided."
            show_help
            exit 1
        fi
        delete_quote "$2"
        ;;
    -t|--add-todo)
        if [ -z "$2" ]; then
            echo "Error: No task provided."
            show_help
            exit 1
        fi
        add_todo "$2"
        ;;
    -l|--view-todos)
        view_todos
        ;;
    -r|--delete-todo)
        if [ -z "$2" ]; then
            echo "Error: No to-do ID provided."
            show_help
            exit 1
        fi
        delete_todo "$2"
        ;;
    -m|--mark-done)
        if [ -z "$2" ]; then
            echo "Error: No to-do ID provided."
            show_help
            exit 1
        fi
        mark_done "$2"
        ;;
    -h|--help|*)
        show_help
        ;;
esac

